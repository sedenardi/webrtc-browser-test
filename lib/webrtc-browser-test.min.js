"use strict";!function(){var e=function(e){this.name="ParameterError",this.message=e||""};e.prototype=Error.prototype;var t=function(e){this.name="BrowserNotSupportedError",this.message=e||""};t.prototype=Error.prototype;var r=function(e){this.name="VideoNotFoundError",this.message=e||"Unable to detect a video camera. Please ensure you've installed and tested your webcam."};r.prototype=Error.prototype;var n=function(e){this.name="VideoDeniedError",this.message=e||"Your browser is preventing access to your camera and microphone. Please check your browser settings (usually an icon in the address bar) to enable access."};n.prototype=Error.prototype;var o=function(e){this.name="AudioNotFoundError",this.message=e||"Unable to detect a microphone. Usually your video camera will have an integrated microphone, but if not please attach and enable one."};o.prototype=Error.prototype;var a=function(e){this.name="AudioDeniedError",this.message=e||"Your browser is preventing access to your microphone. Please check your browser settings (usually an icon in the address bar) to enable access."};a.prototype=Error.prototype;var i=function(i){if("string"==typeof i.mediaElementContainer&&(i.mediaElementContainer=document.querySelector(i.mediaElementContainer)),!(i.mediaElementContainer&&i.mediaElementContainer instanceof Element))throw new e("Missing required element parameter. Tests can't continue.");if(i.onVolumeChange&&"function"!=typeof i.onVolumeChange)throw new e("Volume callback parameter must be a function. Tests can't continue.");if(!window.Promise)throw new t("Your browser doesn't support Promises. Tests can't continue.");var s=document.querySelector("#videoContainer > video");s||((s=document.createElement("video")).setAttribute("autoplay",!0),i.mediaElementContainer.appendChild(s));var c=document.querySelector("#videoContainer > audio");c||((c=document.createElement("audio")).setAttribute("autoplay",!0),i.mediaElementContainer.appendChild(c));var u,d,m=function(e){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(e):navigator.getUserMedia?new Promise(function(t,r){navigator.getUserMedia(e,t,r)}):navigator.mozGetUserMedia?new Promise(function(t,r){navigator.mozGetUserMedia(e,t,r)}):navigator.webkitGetUserMedia?new Promise(function(t,r){navigator.webkitGetUserMedia(e,t,r)}):void 0},l=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia?Promise.resolve():Promise.reject(new t("Your browser doesn't support WebRTC."))},h=function(){return l().then(function(){return m({video:!0}).then(function(e){return u=e,s.srcObject=e,Promise.resolve()}).catch(function(e){throw"NotFoundError"===e.name?new r:"NotAllowedError"===e.name?new n:"PermissionDeniedError"===e.name?new n:e})})},p=function(){return l().then(function(){return m({audio:!0}).then(function(e){return c.srcObject=e,v(e)}).catch(function(e){throw"NotFoundError"===e.name?new o:"NotAllowedError"===e.name?new a:"PermissionDeniedError"===e.name?new a:e})})},v=function(e){var r;try{window.AudioContext=window.AudioContext||window.webkitAudioContext,r=new AudioContext}catch(e){return Promise.reject(new t("Your browser doesn't support web audio."))}var n=function(e,t){var r=e.createScriptProcessor(2048,1,1);r.connect(e.destination);var n=null;return r.onaudioprocess=function(e){for(var r=e.inputBuffer.getChannelData(0),o=0,a=0;o<r.length;)a+=Math.abs(r[o++]);var i=Math.sqrt(a/r.length);n=null===n||n<i?i:.7*n+.3*i;var s=Math.log(n)/Math.LN10/1.5+1;s=Math.min(Math.max(s,0),1),t&&t(s)},r}(r,i.onVolumeChange);try{return r.createMediaStreamSource(e).connect(n),Promise.resolve()}catch(e){return Promise.reject(e)}},w=function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia)};return{checkBrowser:l,startVideo:h,startAudio:p,startAll:function(){return l().then(function(){return h()}).then(function(){return p()})},checkScreenSharing:w,startScreenSharing:function(){return w()?navigator.mediaDevices.getDisplayMedia({video:!0}).then(function(e){d=e,s.srcObject=d}).catch(console.log):Promise.reject(new t("Your browser doesn't support screen sharing."))},endScreenSharing:function(){if(!d)throw new Error("Screen sharing hasn't been started yet.");s.srcObject=u,d.getTracks().forEach(function(e){return e.stop()}),d=null}}};"undefined"==typeof module||void 0===module.exports?window.WebRtcBrowserTest=i:module.exports=i}();